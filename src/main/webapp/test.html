<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Insert title here</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
<script src="//code.jquery.com/jquery-2.1.4.js" ></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="//cdn.jsdelivr.net/sockjs/0.3.4/sockjs.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.js"></script>
</head>

<body>

<div class="panel panel-default">
  <div class="panel-heading">ログイン・ログアウト</div>
  <div class="panel-body">
    <form>
		<label for="username">Username: </label><input id="username" name="username"><br/>
		<label for="password">Password:</label><input id="password" name="password"><br/>
		<button id="login" class="btn btn-default">Login!</button>
		<button id="logout" class="btn btn-default">Logout!</button>
	</form>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">TestControllerへのアクセス</div>
  <div class="panel-body">
    <button id="find" class="btn btn-default">find</button>
	<button id="findOne" class="btn btn-default">findOne</button>
	<button id="create" class="btn btn-default">create</button>
	<button id="error" class="btn btn-default">error</button>
	<button id="async" class="btn btn-default">async</button>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">Simple WebSocketへのアクセス</div>
  <div class="panel-body">
    <div id="log"></div>
	  <form>
	    <input type="text" id="message" /> <button id="send" class="btn btn-default">送信</button>
	  </form>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">stomp WebSocketへのアクセス</div>
  <div class="panel-body">
    <div id="stomp-log"></div>
	  <form>
	    <input type="text" id="stomp-message" /> <button id="stomp-send" class="btn btn-default">送信</button>
	  </form>
  </div>
</div>
<script>
var _data;
$("#find").click(function(){
	$.get("api/test").done(function(data){
		console.log(data);
	}).fail(function(jqXHR, textStatus, errorThrown) {
		console.log("fail:" + textStatus);
	});
});
$("#findOne").click(function(){
	$.get("api/test/aaa").done(function(data){
		console.log(data);
		_data = data;
	}).fail(function(jqXHR, textStatus, errorThrown) {
		console.log("fail:" + textStatus);
	});
});
$("#create").click(function(){
	$.ajax({
		url:"api/test", 
		type:"PUT",
		data:JSON.stringify(_data), 
		contentType: "application/json; charset=utf-8",
		dataType: "json"}).fail(function(jqXHR, textStatus, errorThrown) {
			console.log("fail:" + textStatus);
		});
});
$("#error").click(function(){
	$.get("api/test/error/error").done(function(data){
		console.log(data);
	}).fail(function(jqXHR, textStatus, errorThrown) {
		console.log("fail:" + textStatus);
	});
});
$("#async").click(function(){
	$.get("api/test/async/get").done(function(data){
		console.log(data);
	}).fail(function(jqXHR, textStatus, errorThrown) {
		console.log("fail:" + textStatus);
	});
});
$('#login').click(function (event) {
	event.preventDefault();
	//var data = 'j_username=' + $('#username').val() + '&j_password=' + $('#password').val();
	var data = {
			username:$('#username').val(),
			password:$('#password').val()
	};
	$.ajax({
		data: data,
		type: 'POST',
		url: 'login'
	}).done(function(data, textStatus, jqXHR) {
		console.log("authentication success");
	}).fail(function(jqXHR, textStatus, errorThrown) {
		console.log("authentication fail");
	});
});
$('#logout').click(function (event) {
	event.preventDefault();
	//var data = 'j_username=' + $('#username').val() + '&j_password=' + $('#password').val();
	$.ajax({
		type: 'GET',
		url: 'logout'
	}).done(function(data, textStatus, jqXHR) {
		console.log("logout success");
	}).fail(function(jqXHR, textStatus, errorThrown) {
		console.log("logout fail");
	});
});

//var ws = new WebSocket("ws://localhost:8080/app/api/echo");
var ws = new SockJS("/app/api/echo");
ws.onopen = function(){
};
ws.onclose = function(){
};
ws.onmessage = function(message){
  $("#log").append(message.data).append("<br/>");
  $("#message").val("")
};
ws.onerror = function(event){
  alert("エラー");
};
$("#send").click(function(){
  ws.send($("#message").val());
  return false;
});
var socket = new SockJS('/app/api/notification');
var stompClient = Stomp.over(socket);
stompClient.connect({}, function(frame) {
    console.log('Connected: ' + frame);
    stompClient.subscribe('/topic/testfeed', function(test){
    	console.log(test);
    	$("#stomp-log").append(test.body).append("<br/>");
    });
});
$("#stomp-send").click(function(){
	stompClient.send("/api/test", {}, JSON.stringify(_data));
  	return false;
});
</script>
</body>
</html>